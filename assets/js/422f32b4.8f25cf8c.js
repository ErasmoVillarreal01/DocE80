"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[5156],{8453:(e,n,a)=>{a.d(n,{R:()=>i,x:()=>l});var r=a(6540);const t={},s=r.createContext(t);function i(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),r.createElement(s.Provider,{value:n},e.children)}},9047:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"T-SQL/Querying Data/JSON and XML/Querying JSON","title":"Querying JSON","description":"What is JSON?","source":"@site/techStack/T-SQL/Querying Data/JSON and XML/Querying JSON.md","sourceDirName":"T-SQL/Querying Data/JSON and XML","slug":"/T-SQL/Querying Data/JSON and XML/Querying JSON","permalink":"/DocE80/techStack/T-SQL/Querying Data/JSON and XML/Querying JSON","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"techStack","previous":{"title":"Temporary Tables","permalink":"/DocE80/techStack/T-SQL/Querying Data/Intermediary Tables/Temporary Tables"},"next":{"title":"Querying XML","permalink":"/DocE80/techStack/T-SQL/Querying Data/JSON and XML/Querying XML"}}');var t=a(4848),s=a(8453);const i={},l=void 0,o={},c=[{value:"What is JSON?",id:"what-is-json",level:2},{value:"Storing in SQL Server",id:"storing-in-sql-server",level:2},{value:"Retrieving JSON Data",id:"retrieving-json-data",level:2},{value:"Scalar Values",id:"scalar-values",level:3},{value:"Non Scalar Values",id:"non-scalar-values",level:3},{value:"IS JSON",id:"is-json",level:3},{value:"Format Query Results as JSON",id:"format-query-results-as-json",level:2},{value:"FOR JSON PATH",id:"for-json-path",level:3},{value:"FOR JSON AUTO",id:"for-json-auto",level:3},{value:"Updating JSON Value",id:"updating-json-value",level:2}];function d(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"what-is-json",children:"What is JSON?"}),"\n",(0,t.jsx)(n.p,{children:"JavaScript Object Notation (JSON) is a lightweight data-interchange format used for communications between application and servers and storing data.\r\nBasic JSON Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-JSON",children:'[{\r\n"employee" : {\r\n\t\t"id" : 12345,\r\n\t\t"first name" : "Xavier",\r\n\t\t"last name" : "Morera",\r\n\t\t"birth" : "14/01/1990",\r\n\t\t"address" : {\r\n\t\t\t"country" : "USA",\r\n\t\t\t"state" : "MN"\r\n\t\t},\r\n\t\t"phone numbers" : [\r\n\t\t{\r\n\t\t\t"type" : "home",\r\n\t\t\t"number" : "555 222 3456",\r\n\t\t},\r\n\t\t{\r\n\t\t\t"type" : "cellphone",\r\n\t\t\t"number" : "555777 8910"\r\n\t\t}\r\n\t\t]\r\n\t}\r\n}]\n'})}),"\n",(0,t.jsx)(n.h2,{id:"storing-in-sql-server",children:"Storing in SQL Server"}),"\n",(0,t.jsxs)(n.p,{children:["To store JSON in our DB we use ",(0,t.jsx)(n.code,{children:"NVARCHAR(max)"})," or ",(0,t.jsx)(n.code,{children:"NVARCHAR(4000)"})," if < 8 KB"]}),"\n",(0,t.jsx)(n.h2,{id:"retrieving-json-data",children:"Retrieving JSON Data"}),"\n",(0,t.jsx)(n.p,{children:"Whenever we want to retrieve data from a JSON we can either retrieve a:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Scalar Value: Single Values"}),"\n",(0,t.jsx)(n.li,{children:"Non Scalar Value: JSON Object"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"scalar-values",children:"Scalar Values"}),"\n",(0,t.jsx)(n.p,{children:"To retrieve a scalar value we use the function JSON_VALUE:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-SQL",children:"-- JSON_VALUE(expression, path)\r\nJSON_VALUE(jsonData, '$.employee.birth')\n"})}),"\n",(0,t.jsx)(n.h3,{id:"non-scalar-values",children:"Non Scalar Values"}),"\n",(0,t.jsx)(n.p,{children:"To retrieve a non scalar value we use the function JSON_QUERY:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-SQL",children:"-- JSON_QUERY(expression, path)\r\nJSON_QUERY(jsonData, '$.employee.address')\n"})}),"\n",(0,t.jsx)(n.h3,{id:"is-json",children:"IS JSON"}),"\n",(0,t.jsx)(n.p,{children:"Test whether a string contains a valid JSON. 1 if valid JSON, 0 if not"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-SQL",children:"-- ISJSON(expression)\r\nSELECT JSON_VALUE(jsonData, '$.Title'), jsonData\r\nFROM Posts\r\nWHERE ISJSON(jsonData) > 0 AND JSON_VALUE(jsonData, '$.Title') LIKE '%c#%';\n"})}),"\n",(0,t.jsx)(n.h2,{id:"format-query-results-as-json",children:"Format Query Results as JSON"}),"\n",(0,t.jsx)(n.p,{children:"To format query results as JSON we use FOR JSON"}),"\n",(0,t.jsx)(n.h3,{id:"for-json-path",children:"FOR JSON PATH"}),"\n",(0,t.jsx)(n.p,{children:"Define the structure of your JSON string"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-SQL",children:"FOR JSON PATH, ROOT ('root_name')\n"})}),"\n",(0,t.jsx)(n.h3,{id:"for-json-auto",children:"FOR JSON AUTO"}),"\n",(0,t.jsx)(n.p,{children:"Structure of your JSON string created automatically"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-SQL",children:"FOR JSON AUTO\n"})}),"\n",(0,t.jsx)(n.h2,{id:"updating-json-value",children:"Updating JSON Value"}),"\n",(0,t.jsx)(n.p,{children:"To update a JSON value we use JSON_MODIFY"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-SQL",children:"-- JSON_MODIFY(expression, path, newValue)\r\nUPDATE Posts\r\nSET jsonData = JSON_MODIFY(jsonData, '$.OwnerUserId', '63')\r\nWHERE JSON_VALUE(jsonData, '$.Id') = '9';\n"})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);