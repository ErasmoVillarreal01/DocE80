"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[9844],{8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>l});var s=n(6540);const r={},a=s.createContext(r);function o(e){const t=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(a.Provider,{value:t},e.children)}},8966:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>E,frontMatter:()=>o,metadata:()=>s,toc:()=>T});const s=JSON.parse('{"id":"Utilities/Scripts/Messages/Shipping/ShipmentFromAMIS","title":"Shipment Process","description":"Overview","source":"@site/docs/Utilities/Scripts/Messages/Shipping/ShipmentFromAMIS.md","sourceDirName":"Utilities/Scripts/Messages/Shipping","slug":"/Utilities/Scripts/Messages/Shipping/ShipmentFromAMIS","permalink":"/DocE80/docs/Utilities/Scripts/Messages/Shipping/ShipmentFromAMIS","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"sql","permalink":"/DocE80/docs/tags/sql"},{"inline":true,"label":"message-processing","permalink":"/DocE80/docs/tags/message-processing"},{"inline":true,"label":"scripts","permalink":"/DocE80/docs/tags/scripts"},{"inline":true,"label":"sdm","permalink":"/DocE80/docs/tags/sdm"},{"inline":true,"label":"shipping","permalink":"/DocE80/docs/tags/shipping"}],"version":"current","frontMatter":{"title":"Shipment Process","tags":["sql","message-processing","scripts","sdm","shipping"]},"sidebar":"techStack","previous":{"title":"Shipping System Messages","permalink":"/DocE80/docs/category/shipping-system-messages-2"},"next":{"title":"Shipment Process","permalink":"/DocE80/docs/Utilities/Scripts/Messages/Shipping/ShipmentMonitorProcess"}}');var r=n(4848),a=n(8453);const o={title:"Shipment Process",tags:["sql","message-processing","scripts","sdm","shipping"]},l=void 0,i={},T=[{value:"Overview",id:"overview",level:2},{value:"Example: Simulating shipment mission from AMIS",id:"example-simulating-shipment-mission-from-amis",level:2}];function p(e){const t={code:"code",h2:"h2",hr:"hr",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(t.p,{children:"The AMIS (Add Mission) message is sent by SDM to instruct the Task Handler to execute a handling mission required for a shipment. When a shipment needs one or more stock units to be moved\u2014whether for preparation, consolidation, staging, or loading\u2014SDM issues an AMIS message to request the physical movement from the source location to the shipment\u2019s designated destination. Through this message, SDM ensures that all handling operations related to the shipment are executed by the automated material\u2011handling system."}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h2,{id:"example-simulating-shipment-mission-from-amis",children:"Example: Simulating shipment mission from AMIS"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-sql",metastring:'title="Shipment mission from AMIS"',children:"SET TRANSACTION ISOLATION LEVEL READ COMMITTED\r\nbegin tran\r\n\r\nDECLARE @ROLLBACK\t\t\tBIT = 1\r\n\r\nDECLARE @ResultCode\t\t\tint\r\nDECLARE @ResultText\t\t\tnvarchar(max)\r\nDECLARE @ResourceNumber\t\tINT = 3\r\nDECLARE @ResourceType\t\tNVARCHAR(50) = 'SingleFork'\r\nDECLARE @TaskNumber\t\t\tNVARCHAR(50)\r\nDECLARE @MessageType\t\tNVARCHAR(50)\r\nDECLARE @ReplyMessageType\tNVARCHAR(50)\r\n\r\nDECLARE @Sender\t\t\t\tNVARCHAR(50) = 'debug'\r\nDECLARE @Receiver\t\t\tNVARCHAR(50) = 'debug'\r\nDECLARE @Result\t\t\t\tINT\r\n\r\nDECLARE @TaskInfo\t\t\tHandling.TaskInfo\r\nDECLARE @OpPosInfo\t\t\tHandling.OpPosInfo\r\nDECLARE @StockUnitInfo\t\tHandling.StockUnitInfo\r\nDECLARE @LPNs\t\t\t\tTABLE (LPN nvarchar(50))\r\n\r\nDECLARE\t@rc Int,\r\n\t\t@XmlReplyMessage xml\r\n\r\n\r\n\r\nDECLARE @XmlMessage xml = N'<Message>\r\n  <Header>\r\n    <Sender>Wms</Sender>\r\n    <Receiver>LGVCS</Receiver>\r\n    <Date>2025-05-14T16:46:53.020</Date>\r\n    <MessageType>AMIS</MessageType>\r\n    <MessageId>109119</MessageId>\r\n  </Header>\r\n  <Body>\r\n    <TaskNumber>W00000000249</TaskNumber>\r\n    <Priority>10</Priority>\r\n    <ResourceType>SingleFork</ResourceType>\r\n    <Column>\r\n      <Source>\r\n        <OpPosInfo OpPointName=\"A-048-L\" Position=\"2\" Level=\"1\" Row=\"1\" StackLevel=\"2\" ResourcePosition=\"1\" LocationLength=\"8715\" LocationClearance=\"5412\" ProductPressure=\"1\" />\r\n      </Source>\r\n      <Destination>\r\n        <OpPosInfo OpPointName=\"CW 23\" Position=\"1\" Level=\"1\" Row=\"1\" StackLevel=\"1\" ResourcePosition=\"1\" OperationHeight=\"0\" LocationLength=\"2000\" LocationClearance=\"9999\" />\r\n      </Destination>\r\n      <Tracking>\r\n        <StockUnitInfo Position=\"1\" StackLevel=\"2\" Row=\"2\" Id_StockUnit=\"257\" Lpn=\"202505120000001319\" Sku=\"101060\" Quantity=\"140\" Length=\"1219\" Width=\"1219\" Height=\"1803\" Weight=\"64\" ForkSide=\"0\" ReelDiskHeight=\"0\" ItemClass=\"Cans\" LoadAid=\"1\" StabilityCode=\"9\" QualityStatus=\"Default\" ExpireDate=\"2025-12-09\" ProductionDate=\"2025-12-01T00:00:00\" ShapeControlResult=\"0\" />\r\n      </Tracking>\r\n    </Column>\r\n  </Body>\r\n</Message>'\r\n\r\n\r\n\r\n/****************************************************************** ARWP **********************************************************************/\r\nPRINT '****************************************************************** ARWP **********************************************************************'\r\n\r\n\tINSERT INTO @TaskInfo\r\n\tSELECT * FROM Handling.ufn_GetTaskInfoFromXmlMsg(@XmlMessage)\r\n\t\t\r\n\tINSERT INTO @OpPosInfo\r\n\tSELECT * FROM Handling.ufn_GetOpPosInfoFromXmlMsg(@XmlMessage)\r\n\t\t\r\n\tINSERT INTO @StockUnitInfo\r\n\tSELECT * FROM Handling.ufn_GetStockUnitInfoFromXmlMsg(@XmlMessage)\r\n\r\n\r\n\tselect @TaskNumber = TaskNumber from @TaskInfo\r\n\t\r\n\tINSERT INTO @LPNs (LPN) SELECT DISTINCT LPN FROM @StockUnitInfo\r\n\r\n\tupdate @TaskInfo\r\n\t\tset MessageType = 'ARWP',\r\n\t\t\tTaskNumber = @TaskNumber,\r\n\t\t\tResourceNumber = @ResourceNumber,\r\n\t\t\tResourceType = @ResourceType,\r\n\t\t\tResultCode = NULL\r\n\r\n\r\n\tEXEC Handling.usp_CreateXMLMessage \r\n\t\t@TaskInfo = @TaskInfo,\r\n\t\t@OpPosInfo = @OpPosInfo, \r\n\t\t@StockUnitInfo = @StockUnitInfo, \r\n\t\t@XmlMessage = @XmlMessage OUT\r\n\r\n\tselect @XmlMessage = cast (replace (cast(@XmlMessage as nvarchar(max)), '<Sender>wms</Sender>','<Sender>LGVCS</Sender>') as xml)\r\n\r\n\t-- delete node Destination (lgvm don't send it)\r\n\tSET @XmlMessage.modify('delete //Destination[1]')  \r\n\r\n\r\n\tEXEC\t@rc = [Handling].[usp_ProcessHandlerMessage_ARWP]\r\n\t\t\t@XmlMessage = @XmlMessage,\r\n\t\t\t@XmlReplyMessage = @XmlReplyMessage OUTPUT\r\n\r\n\r\n\tDELETE FROM @TaskInfo\r\n\tDELETE FROM @OpPosInfo\r\n\tDELETE FROM @StockUnitInfo\r\n\t\t\r\n\tINSERT INTO @TaskInfo\r\n\tSELECT * FROM Handling.ufn_GetTaskInfoFromXmlMsg(@XmlReplyMessage)\r\n\t\r\n\tINSERT INTO @OpPosInfo\r\n\tSELECT * FROM Handling.ufn_GetOpPosInfoFromXmlMsg(@XmlReplyMessage)\r\n\t\t\r\n\tINSERT INTO @StockUnitInfo\r\n\tSELECT * FROM Handling.ufn_GetStockUnitInfoFromXmlMsg(@XmlReplyMessage)\r\n\r\n\tSELECT @ReplyMessageType = NULL\r\n\tSELECT @ReplyMessageType = MessageType, @Result = ResultCode FROM @TaskInfo\r\n\t\r\n\r\n\tSELECT @MessageType = 'ARWP'\r\n\tSELECT\t@MessageType, @XmlMessage\r\n\tSELECT\t@ReplyMessageType,\t@XmlReplyMessage as N'@XmlReplyMessage'\r\n\tSELECT\t@rc as 'Return Value'\r\n\r\n\r\n\r\n/****************************************************************** PKUP **********************************************************************/\r\nPRINT '****************************************************************** PKUP **********************************************************************'\r\n\t\r\n\tIF @ReplyMessageType = 'PPOS'\r\n\tBEGIN\r\n\r\n\t\tupdate @TaskInfo\r\n\t\t\tset MessageType = 'PKUP',\r\n\t\t\t\tTaskNumber = @TaskNumber,\r\n\t\t\t\tResourceNumber = @ResourceNumber,\r\n\t\t\t\tResourceType = @ResourceType,\r\n\t\t\t\tResultCode = NULL\r\n\r\n\r\ndelete from @OpPosInfo where ParentNode = 'Destination'\r\n\r\n\r\n\t\tEXEC Handling.usp_CreateXMLMessage \r\n\t\t\t@TaskInfo = @TaskInfo,\r\n\t\t\t@OpPosInfo = @OpPosInfo, \r\n\t\t\t@StockUnitInfo = @StockUnitInfo, \r\n\t\t\t@XmlMessage = @XmlMessage OUT\r\n\r\n\t\tselect @XmlMessage = cast (replace (cast(@XmlMessage as nvarchar(max)), '<Sender>wms</Sender>','<Sender>LGVCS</Sender>') as xml)\r\n\r\n\t\t-- delete node Destination (lgvm don't send it)\r\n\t\tSET @XmlMessage.modify('delete //Destination[1]')  \r\n\r\n\t\tEXECUTE @RC = [Handling].[usp_ProcessHandlerMessage_PKUP] \r\n\t\t   @XmlMessage\r\n\t\t  ,@XmlReplyMessage OUTPUT\r\n\t\t  ,@ResultCode OUTPUT\r\n\t\t  ,@ResultText OUTPUT\r\n\r\n\t\tDELETE FROM @TaskInfo\r\n\t\tDELETE FROM @OpPosInfo\r\n\t\tDELETE FROM @StockUnitInfo\r\n\t\r\n\t\tINSERT INTO @TaskInfo\r\n\t\tSELECT * FROM Handling.ufn_GetTaskInfoFromXmlMsg(@XmlReplyMessage)\r\n\t\t\r\n\t\tINSERT INTO @OpPosInfo\r\n\t\tSELECT * FROM Handling.ufn_GetOpPosInfoFromXmlMsg(@XmlReplyMessage)\r\n\t\t\r\n\t\tINSERT INTO @StockUnitInfo\r\n\t\tSELECT * FROM Handling.ufn_GetStockUnitInfoFromXmlMsg(@XmlReplyMessage)\r\n\r\n\t\tDELETE FROM @LPNs\r\n\t\tINSERT INTO @LPNs (LPN) SELECT DISTINCT LPN FROM @StockUnitInfo\r\n\r\n\t\tSELECT @ReplyMessageType = NULL\r\n\t\tSELECT @ReplyMessageType = MessageType FROM @TaskInfo\r\n\r\n\r\n\t\tSELECT @MessageType = 'PKUP'\r\n\t\tSELECT  @MessageType, @XmlMessage\r\n\t\tSELECT\t@ReplyMessageType,\t@XmlReplyMessage as N'@XmlReplyMessage'\r\n\t\tSELECT\t@rc as 'Return Value'\r\n\r\n\r\n\tEND\r\n\r\n/****************************************************************** ARWD CHECKPOINT **********************************************************************/\r\nPRINT '****************************************************************** ARWD CHECKPOINT **********************************************************************'\r\n\t\r\n\tIF @ReplyMessageType = 'MMIS'\r\n\tBEGIN\r\n\r\n\t\tupdate @TaskInfo\r\n\t\t\tset MessageType = 'ARWD',\r\n\t\t\t\tTaskNumber = @TaskNumber,\r\n\t\t\t\tResourceNumber = @ResourceNumber,\r\n\t\t\t\tResourceType = @ResourceType\r\n\r\n\t\tEXEC Handling.usp_CreateXMLMessage \r\n\t\t\t@TaskInfo = @TaskInfo,\r\n\t\t\t@OpPosInfo = @OpPosInfo, \r\n\t\t\t@StockUnitInfo = @StockUnitInfo, \r\n\t\t\t@XmlMessage = @XmlMessage OUT\r\n\r\n\t\tselect @XmlMessage = cast (replace (cast(@XmlMessage as nvarchar(max)), '<Sender>wms</Sender>','<Sender>LGVCS</Sender>') as xml)\r\n\r\n\r\n\t\tEXECUTE @RC = [Handling].[usp_ProcessHandlerMessage_ARWD] \r\n\t\t   @XmlMessage\r\n\t\t  ,@XmlReplyMessage OUTPUT\r\n\t\t  ,@ResultCode OUTPUT\r\n\t\t  ,@ResultText OUTPUT\r\n\r\n\t\tDELETE FROM @TaskInfo\r\n\t\tDELETE FROM @OpPosInfo\r\n\t\tDELETE FROM @StockUnitInfo\r\n\t\r\n\t\tINSERT INTO @TaskInfo\r\n\t\tSELECT * FROM Handling.ufn_GetTaskInfoFromXmlMsg(@XmlReplyMessage)\r\n\t\t\r\n\t\tINSERT INTO @OpPosInfo\r\n\t\tSELECT * FROM Handling.ufn_GetOpPosInfoFromXmlMsg(@XmlReplyMessage)\r\n\t\t\r\n\t\tINSERT INTO @StockUnitInfo\r\n\t\tSELECT * FROM Handling.ufn_GetStockUnitInfoFromXmlMsg(@XmlReplyMessage)\r\n\r\n\t\tSELECT @ReplyMessageType = NULL\r\n\t\tSELECT @ReplyMessageType = MessageType FROM @TaskInfo\r\n\r\n\r\n\t\tSELECT @MessageType = 'ARWD'\r\n\t\tSELECT  @MessageType, @XmlMessage\r\n\t\tSELECT\t@ReplyMessageType,\t@XmlReplyMessage as N'@XmlReplyMessage'\r\n\t\tSELECT\t@rc as 'Return Value'\r\n\r\n\r\n\t\t\r\n\r\n\t\t\r\n\tEND\r\n\r\n\r\n/****************************************************************** ARWD **********************************************************************/\r\nPRINT '****************************************************************** ARWD **********************************************************************'\r\n\t\r\n\tIF @ReplyMessageType = 'MMIS'\r\n\tBEGIN\r\n\r\n\t\tupdate @TaskInfo\r\n\t\t\tset MessageType = 'ARWD',\r\n\t\t\t\tTaskNumber = @TaskNumber,\r\n\t\t\t\tResourceNumber = @ResourceNumber,\r\n\t\t\t\tResourceType = @ResourceType\r\n\r\n\t\tEXEC Handling.usp_CreateXMLMessage \r\n\t\t\t@TaskInfo = @TaskInfo,\r\n\t\t\t@OpPosInfo = @OpPosInfo, \r\n\t\t\t@StockUnitInfo = @StockUnitInfo, \r\n\t\t\t@XmlMessage = @XmlMessage OUT\r\n\r\n\t\tselect @XmlMessage = cast (replace (cast(@XmlMessage as nvarchar(max)), '<Sender>wms</Sender>','<Sender>LGVCS</Sender>') as xml)\r\n\r\n\r\n\t\tEXECUTE @RC = [Handling].[usp_ProcessHandlerMessage_ARWD] \r\n\t\t   @XmlMessage\r\n\t\t  ,@XmlReplyMessage OUTPUT\r\n\t\t  ,@ResultCode OUTPUT\r\n\t\t  ,@ResultText OUTPUT\r\n\r\n\t\tDELETE FROM @TaskInfo\r\n\t\tDELETE FROM @OpPosInfo\r\n\t\tDELETE FROM @StockUnitInfo\r\n\t\r\n\t\tINSERT INTO @TaskInfo\r\n\t\tSELECT * FROM Handling.ufn_GetTaskInfoFromXmlMsg(@XmlReplyMessage)\r\n\t\t\r\n\t\tINSERT INTO @OpPosInfo\r\n\t\tSELECT * FROM Handling.ufn_GetOpPosInfoFromXmlMsg(@XmlReplyMessage)\r\n\t\t\r\n\t\tINSERT INTO @StockUnitInfo\r\n\t\tSELECT * FROM Handling.ufn_GetStockUnitInfoFromXmlMsg(@XmlReplyMessage)\r\n\r\n\t\tSELECT @ReplyMessageType = NULL\r\n\t\tSELECT @ReplyMessageType = MessageType FROM @TaskInfo\r\n\r\n\r\n\t\tSELECT @MessageType = 'ARWD'\r\n\t\tSELECT  @MessageType, @XmlMessage\r\n\t\tSELECT\t@ReplyMessageType,\t@XmlReplyMessage as N'@XmlReplyMessage'\r\n\t\tSELECT\t@rc as 'Return Value'\r\n\r\n\r\n\t\t\r\n\r\n\t\t\r\n\tEND\r\n\r\n\r\n\t/****************************************************************** DPAL **********************************************************************/\r\nPRINT '****************************************************************** DPAL **********************************************************************'\r\n\t\r\n\tIF @ReplyMessageType = 'DPOS'\r\n\tBEGIN\r\n\t\tupdate @TaskInfo\r\n\t\t\tset MessageType = 'DPAL',\r\n\t\t\t\tTaskNumber = @TaskNumber,\r\n\t\t\t\tResourceNumber = @ResourceNumber,\r\n\t\t\t\tResourceType = @ResourceType\r\n\r\n\t\tEXEC Handling.usp_CreateXMLMessage \r\n\t\t\t@TaskInfo = @TaskInfo,\r\n\t\t\t@OpPosInfo = @OpPosInfo, \r\n\t\t\t@StockUnitInfo = @StockUnitInfo, \r\n\t\t\t@XmlMessage = @XmlMessage OUT\r\n\r\n\t\tselect @XmlMessage = cast (replace (cast(@XmlMessage as nvarchar(max)), '<Sender>wms</Sender>','<Sender>LGVCS</Sender>') as xml)\r\n\r\n\r\n\r\n\t\tEXECUTE @RC = [Handling].[usp_ProcessHandlerMessage_DPAL] \r\n\t\t   @XmlMessage\r\n\t\t  ,@XmlReplyMessage OUTPUT\r\n\t\t  ,@ResultCode OUTPUT\r\n\t\t  ,@ResultText OUTPUT\r\n\r\n\t\tDELETE FROM @TaskInfo\r\n\t\tDELETE FROM @OpPosInfo\r\n\t\tDELETE FROM @StockUnitInfo\r\n\t\r\n\t\tINSERT INTO @TaskInfo\r\n\t\tSELECT * FROM Handling.ufn_GetTaskInfoFromXmlMsg(@XmlReplyMessage)\r\n\t\t\r\n\t\tINSERT INTO @OpPosInfo\r\n\t\tSELECT * FROM Handling.ufn_GetOpPosInfoFromXmlMsg(@XmlReplyMessage)\r\n\t\t\r\n\t\tINSERT INTO @StockUnitInfo\r\n\t\tSELECT * FROM Handling.ufn_GetStockUnitInfoFromXmlMsg(@XmlReplyMessage)\r\n\r\n\t\tSELECT @ReplyMessageType = NULL\r\n\t\tSELECT @ReplyMessageType = MessageType FROM @TaskInfo\r\n\r\n\t\tSELECT @MessageType = 'DPAL'\r\n\t\tSELECT  @MessageType, @XmlMessage\r\n\t\tSELECT\t@ReplyMessageType, @XmlReplyMessage as N'@XmlReplyMessage'\r\n\t\tSELECT\t@rc as 'Return Value'\r\n\r\n\t\t\r\n\r\n\t\t\r\n\r\n\t\t\r\n\tEND\r\n\r\n\r\n\r\n\r\nDECLARE @AMISMessages xml\r\nDECLARE @SendMessages bit\r\nDECLARE\t@return_value Int\r\n\r\n\r\nEXECUTE @RC = [Shipping].[usp_OutboundShipmentMonitorProcess] \r\n\r\n\r\nselect 'ShippedStockUnits',* from Shipping.ShippedStockUnit\r\n\tselect * from Integration.HostOutgoingMessage order by InsertDateTime desc\r\n\r\nSELECT * FROM Shipping.Shipment\r\n\r\n\r\nIF @ROLLBACK = 1\r\n\trollback\r\nELSE\r\n\tcommit\r\nGO\r\n\r\n\n"})})]})}function E(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}}}]);