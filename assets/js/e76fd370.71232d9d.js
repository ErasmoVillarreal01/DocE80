"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[2949],{4983:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>c,default:()=>E,frontMatter:()=>i,metadata:()=>r,toc:()=>N});const r=JSON.parse('{"id":"SDM DB/usp_UpdateLocationToBlockedSlowMover","title":"usp_UpdateLocationToBlockedSlowMover","description":"Procedure to alternate between Vertique Slow Mover lanes for dropping stock units","source":"@site/queries/SDM DB/usp_UpdateLocationToBlockedSlowMover.md","sourceDirName":"SDM DB","slug":"/SDM DB/usp_UpdateLocationToBlockedSlowMover","permalink":"/DocE80/queries/SDM DB/usp_UpdateLocationToBlockedSlowMover","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"techStack","previous":{"title":"Queries","permalink":"/DocE80/queries/intro"}}');var o=t(4848),a=t(8453);const i={},c="usp_UpdateLocationToBlockedSlowMover",s={},N=[];function d(e){const n={code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"usp_updatelocationtoblockedslowmover",children:"usp_UpdateLocationToBlockedSlowMover"})}),"\n",(0,o.jsx)(n.p,{children:"Procedure to alternate between Vertique Slow Mover lanes for dropping stock units"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"USE [SDM_DB]\r\nGO\r\n/****** Object:  StoredProcedure [Custom].[usp_UpdateLocationToBlockedSlowMover]    Script Date: 12/02/2026 09:47:18 a. m. ******/\r\nSET ANSI_NULLS ON\r\nGO\r\nSET QUOTED_IDENTIFIER ON\r\nGO\r\n\r\nALTER PROCEDURE [Custom].[usp_UpdateLocationToBlockedSlowMover]\r\n\t@IdContainer\t\tINT,\r\n\t@ResultCode\t\t\tINT  OUTPUT,\r\n\t@ResultText\t\t\tXML  OUTPUT\r\nAS\r\nBEGIN\r\n    SET NOCOUNT ON;\r\n\r\n    BEGIN TRY\r\n\r\n\r\n        DECLARE @trancount\t\t\t\t\t\t\tINT,\r\n\t\t\t\t@rc\t\t\t\t\t\t\t\t\tINT = 0\r\n        DECLARE @actProcName SYSNAME = OBJECT_NAME(@@PROCID);\r\n        DECLARE @ContainerName NVARCHAR(50),\r\n                @NewContainerName NVARCHAR(50),\r\n                @NewIdContainer INT;\r\n\r\n        SELECT @ContainerName = Name\r\n        FROM Warehouse.ContainerName\r\n        WHERE IdContainer = @IdContainer;\r\n\r\n         IF EXISTS (\r\n            SELECT 1 FROM Warehouse.[Block] blk\r\n            INNER JOIN Storage.Automation au\r\n            on blk.IdContainer = au.Id_Container\r\n            WHERE IdContainer = @IdContainer and au.Id_AutomationStatus = 10\r\n        )\r\n        BEGIN\r\n            IF RIGHT(@ContainerName, 1) = N'A'\r\n                SET @NewContainerName = LEFT(@ContainerName, LEN(@ContainerName) - 1) + N'B';\r\n            ELSE IF RIGHT(@ContainerName, 1) = N'B'\r\n                SET @NewContainerName = LEFT(@ContainerName, LEN(@ContainerName) - 1) + N'A';\r\n\r\n            SELECT TOP(1) @NewIdContainer = IdContainer\r\n            FROM Warehouse.ContainerName\r\n            WHERE Name = @NewContainerName;\r\n\r\n            IF NOT EXISTS (\r\n                SELECT 1 FROM Warehouse.[Block] blk\r\n                INNER JOIN Storage.Automation au\r\n                on blk.IdContainer = au.Id_Container\r\n                WHERE IdContainer = @NewIdContainer and au.Id_AutomationStatus = 10\r\n            )\r\n            BEGIN -- when one slow mover blocked\r\n               INSERT INTO InMemoryTmp.UnfitLocation ([IdLocation], ResultCode, ProcedureName, NestLevel, Peremptory) \r\n               VALUES ( @IdContainer, '' , @actProcName, @@NESTLEVEL, 1 )\r\n               RETURN @NewIdContainer\r\n            END\r\n            else -- when both blocked\r\n            begin \r\n                INSERT INTO InMemoryTmp.UnfitLocation ([IdLocation], ResultCode, ProcedureName, NestLevel, Peremptory) \r\n                VALUES ( @IdContainer, '' , @actProcName, @@NESTLEVEL, 1 ), ( @NewIdContainer, '' , @actProcName, @@NESTLEVEL, 1 )\r\n                RETURN @IdContainer\r\n            end\r\n        END\r\n        RETURN @IdContainer\r\n    END TRY\r\n\r\n \r\n\tBEGIN CATCH \r\n\t\t--DECLARE @xstate INT = XACT_STATE()\r\n\t\t--IF ( (@xstate = 1 AND @trancount = 0) OR @xstate = -1 )\r\n\t\t--\tROLLBACK;\r\n\t\t--IF ( (@xstate = 1 AND @trancount = 0) OR @xstate IN (-1, 0) )\r\n\t\t--\tEXEC [Common].[usp_LogProcedureError] @LoggingProcedure = @actProcName;\r\n \r\n\t\t--THROW;\r\n\t\t--RETURN 99   \r\n\tEND CATCH\t \r\nEND\r\n\r\n\r\n\r\n\r\nselect * from Warehouse.ContainerName \n"})})]})}function E(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>c});var r=t(6540);const o={},a=r.createContext(o);function i(e){const n=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);